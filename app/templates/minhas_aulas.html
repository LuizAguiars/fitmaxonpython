<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitmax Gym</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/minhasaulas.css') }}">

</head>
<body>
  <header>
    <div class="logo">
        <img src="{{ url_for('static', filename='IMG/logo.png') }}" alt="FitmaxLogo">
    </div>

 <h1> MINHAS AULAS</h1>

    <div class="usuario-logado">
       
        <form method="POST" action="{{ url_for('auth.logout') }}">
            <button type="submit">Sair</button>
        </form>
    </div>

    <!-- Aqui vem o horário, abaixo da busca -->
    <nav class="menu-logado">
      <a  href="{{ url_for('home.painel_gestor') }}">Painel do Gestor</a>
      <a  href="{{ url_for('home.painel_personal') }}">Painel do Personal</a>
      <a  href="{{ url_for('usuarios.minha_conta') }}">Minha Conta</a>
      <a  href="{{ url_for('usuarios.minhas_aulas') }}">Minhas Aulas</a>
      <a  href="{{ url_for('home.inicial_logado') }}">Voltar a Tela Inicial</a>
      <a  href="{{ url_for('feedbacks.feedbacks') }}">Realizar feedbacks</a>
  </nav>
  
</header>
<br>

  <main>
   
    <div id="aviso-falta" style="max-width: 520px; margin: 0 auto 18px auto; background: #fffbe9; color: #b85c00; border-radius: 12px; box-shadow: 0 2px 8px rgba(255,200,0,0.08); padding: 16px 24px; text-align: center; font-size: 1.08em; font-weight: 500;">
      <span style="font-size:1.2em; font-weight:bold; color:#e74c3c;">Atenção:</span> evite faltar suas aulas/treinos! Faltas prejudicam seu progresso e podem limitar novos agendamentos.
    </div>
    <script>
      setTimeout(function() {
        var aviso = document.getElementById('aviso-falta');
        if(aviso) { aviso.style.transition = 'opacity 0.7s'; aviso.style.opacity = 0; setTimeout(function(){ aviso.remove(); }, 800); }
      }, 10000);
    </script>
    {% if aulas %}
      <div class="minhas-aulas-cards">
        {% for aula in aulas %}
          <div class="aula-card {{ aula.status|lower }}">
            <h3>{{ aula.nome_tipo_treino }}</h3>
            <p style="color:#232b4a;"><b>Personal:</b> {{ aula.Nome_Personal }}</p>
            <p style="color:#232b4a;"><b>Data:</b> {{ aula.DataTreino.strftime('%d/%m/%Y') if aula.DataTreino.__class__.__name__ in ['date', 'datetime'] else aula.DataTreino }} | <b>Hora:</b> {% if aula.HoraTreino.__class__.__name__ == 'time' %}{{ aula.HoraTreino.strftime('%H:%M') }}{% elif aula.HoraTreino.__class__.__name__ == 'datetime' %}{{ aula.HoraTreino.strftime('%H:%M') }}{% elif aula.HoraTreino.__class__.__name__ == 'timedelta' %}{{ "%02d" % (aula.HoraTreino.seconds // 3600) }}:{{ "%02d" % ((aula.HoraTreino.seconds // 60) % 60) }}{% else %}{{ aula.HoraTreino[:5] if ':' in aula.HoraTreino else aula.HoraTreino }}{% endif %}</p>
            <p style="color:#232b4a;"><b>Status:</b> <span class="status {{ aula.status|lower }}">{{ 'Falta' if aula.status in ['Ausente','Falta','Não Concluído'] else aula.status }}</span></p>
            {% if aula.status == 'Agendado' %}
              {% set data_str = aula.DataTreino.strftime('%Y-%m-%d') if aula.DataTreino.__class__.__name__ in ['date', 'datetime'] else aula.DataTreino %}
              {% if aula.HoraTreino.__class__.__name__ == 'time' %}
                {% set hora_str = aula.HoraTreino.strftime('%H:%M') %}
              {% elif aula.HoraTreino.__class__.__name__ == 'datetime' %}
                {% set hora_str = aula.HoraTreino.strftime('%H:%M') %}
              {% elif aula.HoraTreino.__class__.__name__ == 'timedelta' %}
                {% set hora_str = ("%02d" % (aula.HoraTreino.seconds // 3600)) ~ ':' ~ ("%02d" % ((aula.HoraTreino.seconds // 60) % 60)) %}
              {% else %}
                {% set hora_str = aula.HoraTreino[:5] if ':' in aula.HoraTreino else aula.HoraTreino %}
              {% endif %}
              <form method="POST" action="{{ url_for('usuarios.cancelar_aula') }}" style="margin-top: 8px; display:inline;" onsubmit="return podeCancelarAula('{{ data_str }}', '{{ hora_str }}')">
                <input type="hidden" name="id_agenda" value="{{ aula.idAgendar_Treino }}">
                <button type="submit" class="cancel-btn" id="cancel-btn-{{ loop.index }}">Cancelar Aula</button>
              </form>
            {% endif %}
          </div>
        {% endfor %}
      </div>
      <script>
        function podeCancelarAula(data, hora) {
          // data: yyyy-mm-dd, hora: HH:MM
          var dataParts = data.split('-');
          var horaParts = hora.split(':');
          var dataAula = new Date(dataParts[0], dataParts[1]-1, dataParts[2], horaParts[0], horaParts[1]);
          var agora = new Date();
          var diffMs = dataAula - agora;
          var diffH = diffMs / (1000*60*60);
          if (diffH < 1) {
            alert('Só é possível cancelar aulas até 1 hora antes do início.');
            return false;
          }
          return true;
        }
      </script>
    {% else %}
      <div style="background: #fff; color: #232b4a; border-radius: 16px; box-shadow: 0 2px 16px rgba(0,0,0,0.10); padding: 32px; max-width: 420px; margin: 40px auto; text-align: center;">
        <h3 style="color: #001f5b;">Nenhuma aula encontrada.</h3>
        <p style="color: #555;">Quando você agendar ou concluir aulas, elas aparecerão aqui.</p>
      </div>
    {% endif %}
  </main>

</body>
</html>
